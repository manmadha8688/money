
{% load static%}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Confirm Loan Request</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #e0f7fa, #f0f4f8);
      display: flex;
      flex-direction: column;
      color: #2c3e50;
    }

    .header {
      background-color: #04c29f;
      color: white;
      padding: 20px 30px;
      border-bottom-left-radius: 40px;
      border-bottom-right-radius: 40px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logo-wrapper {
      position: absolute;
      left: 30px;
    }
    
    .company-logo {
      width: 80px;
      height: auto;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .company-info {
      text-align: center;
    }
    
    .company-info h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: 1px;
    }
    
    .company-info p {
      margin: 5px 0 0;
      font-size: 14px;
      font-style: italic;
    }
    
    .container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px 5px;
    }

    .main {
      background: white;
      border-radius: 16px;
      max-width: 700px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.6s ease-in-out;
      margin-bottom: 5%;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      text-align: center;
      font-size: 26px;
      margin-bottom: 10px;
      color: #34495e;
    }

    .message {
      text-align: center;
      font-size: 15px;
      color: #555;
      margin-bottom: 30px;
    }

    .details .row {
      display: flex;
      align-items: center;
      margin: 10px 0;
      font-size: 15px;
    }

    .label {
      font-weight: 600;
      color: #2c3e50;
      min-width: 160px;
      margin-left: 20%;
      display: flex;
      justify-content: flex-end;
      position: relative;
      font-size: 17px;
    }

    .label::after {
      content: ":";
      margin-left: 10px;
      margin-right: 10px;
      font-weight: normal;
    }

    .value {
      color: #555;
      flex: 1;
      margin-left: 20px;
      font-size: 16px;
    }

    .btn-group {
      text-align: center;
      margin-top: 25px;
    }

    .btn {
      display: inline-block;
      margin: 8px;
      padding: 10px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .proceed-btn {
      background-color: #3498db;
      color: white;
      margin-bottom: 50px;
    }

    .proceed-btn:hover {
      background-color: #2c80b4;
    }

    .cancel-btn {
      background-color: #e74c3c;
      color: white;
    }

    .cancel-btn:hover {
      background-color: #c0392b;
    }

    .payment-section {
      display: none;
      margin-left: 50px;
      margin-top: 30px;
      margin-bottom: 100px;
      background: #f9f9f9;
      padding: 25px;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
    }

    .payment-section label {
      font-weight: 600;
      display: block;
      margin-top: 30px;
    }

    .payment-section select,
    .payment-section input[type="text"],
    .payment-section input[type="file"] {
      width: 100%;
      padding: 10px;
      margin-top: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    .payment-section button {
      margin-top: 30px;
      background: #2ecc71;
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
    }

    .payment-section button:hover {
      background: #27ae60;
    }

    .hidden {
      display: none;
    }
    .payment-heading{
           text-align: center; margin: 5px 0 15px; font-size: 22px;
            color: #2c3e50;
    }
    .note{
      background: #fef9c3; border: 1px solid #facc15; color: #92400e; 
            padding: 10px 15px; border-radius: 10px; font-size: 18px; 
            text-align: center; margin: 10px 30px 20px;

    }
    
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-box {
      background: white;
      padding: 25px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: var(--shadow);
      text-align: center;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    .modal-box h3 {
      margin-bottom: 10px;
      color: #333;
    }
    
    .modal-box textarea {
      width: 100%;
      padding: 10px;
      resize: none;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    
    .modal-buttons {
      display: flex;
      gap: 20px;
    }
    
    .btn-confirm {
      background-color: var(--danger);
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    
    .btn-close {
      background-color: #1471b0;
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-confirm:hover{
       background-color: red;
    }
    .btn-close:hover{
      background-color: rgb(6, 6, 216);
    }
    .blink {
      animation: blinkBorder 0.3s linear 3;
      border-color: red !important;
    }
    
    @keyframes blinkBorder {
      0% { border-color: red; }
      50% { border-color: #ccc; }
      100% { border-color: red; }
    }
    .btn-confirm1{
      background-color: rgb(253, 92, 92);
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 30%;
    }
    .btn-confirm1:hover{
          background-color: rgb(251, 4, 4);
    }
    .btn {
      padding: 10px 20px;
      text-decoration: none;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s ease;
      cursor: pointer;
  }

  

  .btn-view {
      background-color: #03a386;
      color: white;
  }

  .btn-view:hover {
      background-color: #2980b9;
  }
    .loan-details {
      display: none;
      text-align: left;
      margin-top: 30px;
      padding: 20px;
      background-color: #fdfdfd;
      border-left: 4px solid #16a085;
      border-radius: 8px;
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.3s ease;
  }

  .loan-details p {
      margin: 6px 0;
      font-size: 14px;
  }

  .loan-details span {
      font-weight: bold;
      display: inline-block;
      width: 140px;
      color: #333;
  }

  @keyframes fadeIn {
      from {
          opacity: 0;
          transform: translateY(20px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }

  @media screen and (max-width: 600px) {
      .cancel-box {
          margin: 20px;
          padding: 30px 20px;
      }
      .loan-details span {
          width: 100px;
      }
  }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo-wrapper">
      {% if loan.lender.profile.company_logo %}
        <img src="{{ loan.lender.profile.company_logo.url }}" alt="Company Logo" class="company-logo">
      {% else %}
        <img src="{% static 'images/default_logo.jpeg' %}" alt="Default Logo" class="company-logo">
      {% endif %}
    </div>
  
    <div class="company-info">
      <h1>{{ loan.lender.profile.company_name }}</h1>
      <p>({{ loan.lender.profile.tagline }})</p>
    </div>
  </div>

  <div class="container">
    <div class="main">
      <h2>Confirm Loan Request</h2>
      <div class="message">
        
        <div class="note">
            Please review the loan request details below.<br>
            <strong>Note:</strong> Proceed to confirm with payment type.<br><br>
            <strong>ðŸ’¬ Lender Remark:</strong> {{ loan.remark }}
        </div>
      </div>

      <div class="details">
        <div class="row"><div class="label">Your Name</div><div class="value">{{ loan.borrower.name }}</div></div>
        <div class="row"><div class="label">Phone</div><div class="value">{{ loan.borrower.phone }}</div></div>
        <div class="row"><div class="label">Email</div><div class="value">{{ loan.borrower.email|default:"-" }}</div></div>
        <div class="row"><div class="label">Loan Item</div><div class="value">{{ loan.loan_item }}</div></div>
        <div class="row"><div class="label">Amount</div><div class="value" style="color: #13e948f3;">â‚¹ {{ loan.amount }}</div></div>
        <div class="row"><div class="label">Interest</div><div class="value" style="color: rgb(238, 9, 9);">{{ loan.interest }}</div></div>
        <div class="row"><div class="label">Start Date</div><div class="value">{{ loan.taken_date }}</div></div>
        <div class="row"><div class="label">Return Date</div><div class="value">{{ loan.return_date }}</div></div>
        <div class="row"><div class="label">Reason</div><div class="value">{{ loan.reason|default:"-" }}</div></div>
        <div class="row"><div class="label">Referral</div><div class="value">{{ loan.referral|default:"-" }}</div></div>
        <div class="row"><div class="label">Token Id</div><div class="value">{{ loan.id }}</div></div>
       
      </div>
      <div class="btn-group">
        <button class="btn proceed-btn" onclick="showPayment()">Proceed</button>
        <button class="btn cancel-btn" onclick="openCancelModal()">Cancel</button>
        <button onclick="toggleContact()" class="btn btn-view" id="contact-btn">Lender Contact Details</button>
      </div>
 
      <div class="loan-details" id="contact-details">
        <p><span>Lender Name</span> {{ loan.lender.profile.name }}</p>
        <p><span>Phone</span> {{ loan.lender.profile.phone }}</p>
        <p><span>Email</span> {{ loan.lender.profile.email }}</p>
        <p><span>Bio</span> {{ loan.lender.profile.bio }}</p>
      </div>
      
      <!-- Hidden Cancel Form -->
      <form id="cancelForm" method="POST" action="{% url 'cancle-loan' loan.id %}" style="display: none;">
        {% csrf_token %}
        <input type="hidden" name="remark" id="cancelRemark">
      </form>
      
      <!-- Cancel Modal -->
      <div id="cancelModal" class="modal-overlay">
        <div class="modal-box">
          <h3>Enter Reason to Cancel</h3>
          <textarea id="cancelInput" placeholder="Type reason..." rows="4"></textarea>
          <div class="modal-buttons">
            <button type="button" onclick="submitCancel()" class="btn-confirm1">Ok</button>
            <button  type="button" onclick="closeCancelModal()" class="btn-close">Close</button>
          </div>
        </div>
      </div>
      
      
      </div>
        
      <form class="payment-section" action="{% url 'payment-details' loan.id %}" id="paymentSection" method="POST" enctype="multipart/form-data">
        <h3 class="payment-heading">ðŸ’° Payment Confirmation</h3>
        {% csrf_token %}
        <label for="payment_type">Payment Method:</label>
        <select name="payment_type"  id="payment_type" onchange="togglePaymentDetails()" required>
          <option value="" disabled selected hidden>-- Select --</option>
          <option value="cash">Cash</option>
          <option value="online">Online</option>
        </select>

        <div id="cashFields" class="hidden">
          <label for="cash_from">From Whom Cash Was Taken:</label>
          <input type="text" name="cash_from" id="cash_from" placeholder="Enter name or reference">
        </div>
        
        

        <div id="onlinePlatformFields" class="hidden">
          <label for="online_method" >Select Payment Platform:</label>
          <select name="online_method" id="online_method" onchange="toggleOnlineMethodFields()">
            <option value="" disabled hidden selected>-- Choose --</option>
            <option value="phonepay">Phone Pay</option>
            <option value="googlepay">Google Pay</option>
            <option value="paytm">Paytm</option>
            <option value="bank">Bank Account</option>
          </select>

          <div id="upiFields" class="hidden">
            <label for="upi_number">UPI Id or Phone Number:</label>
            <input type="text" name="upi_number" placeholder="Enter UPI number">
            <label for="upi_screenshot">Upload Payment Screenshot (optional):</label>
            <input type="file" name="upi_screenshot">
          </div>

          <div id="bankFields" class="hidden">
            <label for="account_number">Account Number:</label>
            <input type="text" name="account_number" placeholder="Enter account number">

            <label for="ifsc">IFSC Code:</label>
            <input type="text" name="ifsc" placeholder="Enter IFSC code">

            <label for="bank_name">Bank Name:</label>
            <input type="text" name="bank_name" placeholder="Enter bank name">
          </div>
        </div>

        <button type="submit" onclick="return confirmSubmit(this)">Confirm Payment</button>
      </form>
    </div>
  </div>

  <script>

    function toggleContact() {
      const contact = document.getElementById('contact-details');
      const button = document.getElementById('contact-btn');
      if (contact.style.display === 'none' || contact.style.display === '') {
        contact.style.display = 'block';
        button.innerText = 'Hide Contact Details';
      } else {
        contact.style.display = 'none';
        button.innerText = 'Lender Contact Details';
      }
    }
    function showPayment() {
      const section = document.getElementById("paymentSection");
      section.style.display = "block";
      section.scrollIntoView({ behavior: 'smooth' });
    }

    function togglePaymentDetails() {
      const type = document.getElementById("payment_type").value;
      const cashFields = document.getElementById("cashFields");
      const onlineFields = document.getElementById("onlinePlatformFields");
    
      cashFields.classList.add("hidden");
      onlineFields.classList.add("hidden");
    
      if (type === "cash") {
        cashFields.classList.remove("hidden");
      } else if (type === "online") {
        onlineFields.classList.remove("hidden");
      }
    
      // Reset inner fields
      document.getElementById("upiFields").classList.add("hidden");
      document.getElementById("bankFields").classList.add("hidden");
    }
    
    function toggleOnlineMethodFields() {
      const method = document.getElementById("online_method").value;
      const upiFields = document.getElementById("upiFields");
      const bankFields = document.getElementById("bankFields");

      upiFields.classList.add("hidden");
      bankFields.classList.add("hidden");

      if (method === "bank") {
        bankFields.classList.remove("hidden");
      } else if (["phonepe", "googlepay", "paytm"].includes(method)) {
        upiFields.classList.remove("hidden");
      }
    }

    function confirmSubmit(button) {
      const paymentType = document.getElementById("payment_type").value;
    
      if (!paymentType) {
        alert("Please select a payment method.");
        return false;
      }
    
      if (paymentType === "cash") {
        const cashFrom = document.getElementById("cash_from").value.trim();
        if (!cashFrom) {
          alert("Please enter from whom cash was taken.");
          document.getElementById("cash_from").focus();
          return false;
        }
      }
    
      if (paymentType === "online") {
        const platform = document.getElementById("online_method").value;
    
        if (!platform) {
          alert("Please select an online payment platform.");
          document.getElementById("online_method").focus();
          return false;
        }
    
        if (["phonepe", "googlepay", "paytm"].includes(platform)) {
          const upi = document.querySelector("input[name='upi_number']").value.trim();
          if (!upi) {
            alert("Please enter UPI ID or phone number.");
            document.querySelector("input[name='upi_number']").focus();
            return false;
          }
        }
    
        if (platform === "bank") {
          const acc = document.querySelector("input[name='account_number']").value.trim();
          const ifsc = document.querySelector("input[name='ifsc']").value.trim();
          const bank = document.querySelector("input[name='bank_name']").value.trim();
    
          if (!acc || !ifsc || !bank) {
            alert("Please fill all bank details: Account Number, IFSC, and Bank Name.");
            if (!acc) document.querySelector("input[name='account_number']").focus();
            else if (!ifsc) document.querySelector("input[name='ifsc']").focus();
            else document.querySelector("input[name='bank_name']").focus();
            return false;
          }
        }
      }
    
      const confirmed = confirm("Are you sure you want to confirm this payment?");
      if (confirmed) {
        button.disabled = true;
        button.form.submit();
      }
    
      return false;
    }
    
  
  
      function openCancelModal() {
        document.getElementById("cancelModal").style.display = "flex";
      }
    
      function closeCancelModal() {
        document.getElementById("cancelModal").style.display = "none";
        const input = document.getElementById("cancelInput");
        input.classList.remove("blink");
        input.value = "";
      }
    
      function submitCancel() {
        const input = document.getElementById("cancelInput");
        const reason = input.value.trim();
    
        if (reason !== "") {
          document.getElementById("cancelRemark").value = reason;
          document.getElementById("cancelForm").submit();
        } else {
          input.classList.add("blink");
          setTimeout(() => input.classList.remove("blink"), 1000);
        }
      }
    </script>
    
    

</body>
</html>
