
{% load static %}
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loan Application Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/loan_form_1.css' %}">
  <link rel="stylesheet" href="{% static 'css/payment_details.css' %}">
  <style>
    :root {
      --primary: #1abc9c;
      --inactive: #e0e0e0;
    }
    #agree-checkbox{
    transform: scale(1.5); 
    font-size: 14px;
  }

  .proceed-btn:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
  
    .proceed-btn {
      background-color: #007bff;
      color: white;
      cursor: pointer; /* Start with "not-allowed" cursor */
    }

    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    td {
      padding: 10px 8px;
      vertical-align: top;
    }

    td:first-child {
      font-weight: 600;
      width: 35%;
      color: rgb(59, 59, 59);
      text-align: left;
      position: relative;
      padding-left: 10%;
    }

    td:first-child::after {
      content: ":";
      position: absolute;
      right: 20px;
      font-weight: bold;
    }

    td:last-child {
      color: black;
    }

    .container {
      max-width: 700px;
      margin: 50px auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .steps {
      display: flex;
      justify-content: space-between;
      position: relative;
      margin-bottom: 40px;
    }

    .progress-bar {
      position: absolute;
      top: 50%;
      left: 0;
      height: 4px;
      width: 100%;
      background: var(--inactive);
      z-index: 0;
      transform: translateY(-50%);
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: var(--primary);
      transition: width 0.4s ease-in-out;
    }

    .step {
      z-index: 1;
      text-align: center;
      flex: 1;
      position: relative;
    }

    .circle {
      width: 40px;
      height: 40px;
      margin: 0 auto;
      background-color: var(--inactive);
      border-radius: 50%;
      line-height: 40px;
      color: white;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .label {
      font-weight: 600;
      color: #2c3e50;
      min-width: 160px;
      justify-content: center;
      display: flex;
      position: relative;
      font-size: 17px;
      margin-bottom: 6px;
    }

    .active .circle,
    .completed .circle {
      background-color: var(--primary);
    }

    .active .label,
    .completed .label {
      color: var(--primary);
      font-weight: bold;
    }

    .form-step {
      display: none;
    }

    .form-step.active {
      display: block;
    }

    .form-group {
      margin-bottom: 20px;
    }

    

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: var(--primary);
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }

    button:hover {
      background-color: #16a085;
    }

    .btns {
      display: flex;
      justify-content: space-between;
      gap:60px;
      margin-top: 30px;
    }
    .custom-checkbox-label {
  display: flex;
  align-items: center;
  font-weight: 600;
  color: #2c3e50;
  font-size: 15px;
  margin-bottom: 6px;
  gap: 10px; /* space between checkbox and text */
}

.custom-checkbox-label input[type="checkbox"] {
  width: 13px;
  height: 13px;
  cursor: pointer;
}

.checkbox-text {
  text-align: left;
  color: #0f72dcdb;
}

    
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-wrapper">
      {% if loan.lender.active_user.company_logo %}
        <img src="{{ loan.lender.active_user.company_logo.url }}" alt="Company Logo" class="company-logo">
      {% else %}
        <img src="{% static 'images/default_logo.jpeg' %}" alt="Default Logo" class="company-logo">
      {% endif %}
    </div>
    <div class="company-info">
      <h1>{{ loan.lender.active_user.company_name }}</h1>
      <p>({{ loan.lender.active_user.tagline }})</p>
    </div>
  </div>
  <div class="container">
    <div class="steps">
      <div class="progress-bar">
        <div class="progress-bar-fill" id="progress-bar-fill"></div>
      </div>

      <div class="step" id="step-1">
        <div class="circle">1</div>
        <div class="label" >Loan Info</div>
      </div>
      <div class="step" id="step-2">
        <div class="circle">2</div>
        <div class="label">Payment Details</div>
      </div>
      <div class="step" id="step-3">
        <div class="circle">3</div>
        <div class="label">Confirmation</div>
      </div>
    </div>

<form id="loanform" method="POST" enctype="multipart/form-data" >
    {% csrf_token %}
    <!-- Step 1 -->
    <div class="form-step active" id="form-step-1">
      
    <input type="hidden" id="apply_date" name="apply_date" />

    <div class="form-group">
      <label for="borrower_name"><span>* </span>Your Name <span class="info-icon" id="borrower_name-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span>
    </label>
      <input type="text" id="borrower_name" name="borrower_name" value="{{ loan.borrower.name|default:'' }}" {% if loan.borrower.name %}readonly{% endif %}  required />
    </div>

    <div class="form-group">
      <label for="phone"> <span>* </span>Phone Number <span class="info-icon" id="phone-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span>
    </label>
      <input type="text" id="phone" name="phone" minlength="10" maxlength="10" pattern="\d{10}" value="{{ loan.borrower.phone|default:'' }}" {% if loan.borrower.phone %}readonly{% endif %}  required />
    </div>

    <div class="form-group">
      <label for="email">Email Address <span class="info-icon" id="email-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span></label>
      <input type="email" id="email" name="email" value="{{ loan.borrower.email|default:'' }}" />
    </div>

    <div class="form-group">
      <label for="loan_item"><span>* </span>Loan Security Item <span class="info-icon" id="loan_item-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span></label>
      <input type="text" id="loan_item" name="loan_item" list="loan_items" placeholder="Select or type an item" value="{{ loan.loan_item|default:'' }}" required />
      <datalist id="loan_items">
        <option value="Mobile">
        <option value="Laptop">
        <option value="Camera">
      </datalist>
    </div>

    <div class="form-group">
      <label for="amount"><span>* </span> Loan Amount <span class="info-icon" id="amount-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span></label>
      <input type="number" id="amount" name="amount" value="{{ loan.amount|default:'' }}" step="0.01" required />
    </div>
    
    <div class="form-group">
      <label for="payment_plan"><span>* </span>Payment Plan <span class="info-icon" id="payment_plan-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span>
    </label>
      <select id="payment_plan" name="payment_plan" default="{{loan.payment_plan}}" required>
        <option value="" disabled selected>-- Select a plan --</option>
        <option value="daily">100 Days Plan</option>
        <option value="weekly">Weekly Plan</option>
        <option value="monthly">Monthly Plan</option>

      </select>
    </div>
    
    <div class="form-group">
      <label for="taken_date"><span>* </span>Loan Start Date <span class="info-icon" id="taken_date-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span>
    </label>
      <input type="date" id="taken_date" name="taken_date" value="{{ loan.taken_date|date:'Y-m-d'|default:'' }}" required />
    </div>

    <div class="form-group">
      <label for="return_date"><span>* </span>Loan End Date <span class="info-icon" id="return_date-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span>
    </label>
      <input type="date" id="return_date" name="return_date" value="{{ loan.return_date|date:'Y-m-d'|default:'' }}" readonly />
    </div>

    <div class="form-group">
      <label for="referral">Referral <span class="info-icon" id="referral-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span>
    </label>
      <input type="text" id="referral" name="referral" value="{{ loan.referral|default:'' }}" placeholder="Enter referral name" />
    </div>

    <!-- <div class="form-group">
      <label id="photo-label" for="photos">Upload Photos <span class="info-icon" id="photos-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span>
    </label>
      <input type="file" id="photos" name="photos" accept="image/*" multiple />
      <div id="preview-container" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;"></div>

      {% for image in loan.loan_item_images.all %}
        <div class="image-wrapper" style="position: relative;">
          <img src="{{ image.image.url }}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; box-shadow: 0 0 4px rgba(0,0,0,0.2);" />
          <button type="button" onclick="window.location.href='{% url 'delete_loan_item_image' image.id %}'"
            style="position: absolute; top: -6px;  background: red; color: white; border: none; border-radius: 50%;
                   width: 20px; height: 20px; font-size: 14px; display: flex; align-items: center; justify-content: center; cursor: pointer;">
            ×
          </button>
        </div>
      {% endfor %}
    </div>
  -->
    <div class="form-group">
      <label for="notes"><span>* </span>Reason for Loan <span class="info-icon" id="notes-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#0d6efd" viewBox="0 0 16 16">
          <path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 12.5A5.5 5.5 0 1 1 8 2.5a5.5 5.5 0 0 1 0 11z"/>
          <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 .876-.252 1.036-.598l.088-.416c-.147.176-.357.252-.548.252-.267 0-.312-.176-.228-.58l.738-3.468c.194-.897-.105-1.319-.808-1.319-.545 0-.876.252-1.036.598l-.088.416.738-.287zM8 5.5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1z"/>
        </svg>
      </span>
    </label>
      <textarea id="notes" name="reason">{{ loan.reason|default_if_none:'' }}</textarea>
    </div>

    <button type="button" onclick="validatestep1()" >Next</button>
  

      
    </div>

    <!-- Step 2 -->
    <div class="form-step" id="form-step-2">
      <h3 class="payment-heading">💰 Payment Details</h3>
        
        <label for="payment_type">Payment Method:</label>
        <select name="payment_type"  id="payment_type" onchange="togglePaymentDetails()" required>
          <option value="" disabled selected >-- Select --</option>
          <option value="cash">Cash</option>
          <option value="online">Online</option>
        </select>

        <div id="cashFields" class="hidden">
          <label for="cash_from">From whom do you want cash?</label>
          <input type="text" name="cash_from" id="cash_from" placeholder="Enter name or reference">
        </div>
        
        

        <div id="onlinePlatformFields" class="hidden">
          <label for="online_method" >Select Payment Platform:</label>
          <select name="online_method" id="online_method" onchange="toggleOnlineMethodFields()">
            <option value="" disabled  selected>-- Choose --</option>
            <option value="phonepay">Phone Pay</option>
            <option value="googlepay">Google Pay</option>
            <option value="paytm">Paytm</option>
            <option value="bank">Bank Account</option>
          </select>

          <div id="upiFields" class="hidden">
            <label for="upi_number">UPI Id or Phone Number:</label>
            <input type="text" name="upi_number" id="upi_number" placeholder="e.g. example@upi or 9876543210" >
            <label for="account_holder_name">Account Holder Name</label>
            <input type="text" name="account_holder_name" id="account_holder_name" placeholder="Enter name as per UPI">
          </div>
            
            

          <div id="bankFields" class="hidden">
            <label for="name">Account Holder Name</label>
            <input type="text" name="bank_account_holder_name" placeholder="Enter name as per UPI">
          
            <label for="account_number">Account Number:</label>
            <input type="text" name="account_number" placeholder="Enter account number">

            <label for="ifsc">IFSC Code:</label>
            <input type="text" name="ifsc" placeholder="Enter IFSC code">
            
            <label for="bank_name">Bank Name:</label>
            <input type="text" name="bank_name" placeholder="Enter bank name">
          </div>
        </div>

        <div class="btns">
        <button type="button" onclick="prevStep()">Back</button>
        <button type="button" onclick="validatestep2()">Next</button>
      </div>
    </div>


    <!-- Step 3 -->
    <div class="form-step" id="form-step-3">
      
      <h3>Confirm Your Loan Details</h3>

  <table>
        <tr><td>Your Name</td><td><div id="confirm_borrower_name"></div></td></tr>
        <tr><td>Phone</td><td><div  id="confirm_phone"></div></td></tr>
        <tr><td>Loan Item</td><td><div  id="confirm_loan_item"></div ></td></tr>
        <tr><td>Amount</td><td style="color: green;">₹ <span style="color: green;" id="confirm_amount"></span></td></tr>
        <tr><td>Taken Date</td><td><div  id="confirm_taken"></div ></td></tr>
        <tr><td>Return Date</td><td><div  id="confirm_return"></div ></td></tr>
        <tr><td>Reason</td><td><div  id="confirm_reason"></div ></td></tr>
          
        <tr><td>Referral</td><td><div  id="confirm_referral"></div ></td></tr>
        
        <tr><td>Payment Plan</td><td > <div  id="confirm_payment_plan"></div ></td></tr>
       <tr> <td colspan="2"> <strong>Payment Details </strong></td>
      </tr>
        <tr><td>Payment Method</td><td ><div  id="confirm_payment_type"></div ></td></tr>
        
        <tr><td>Payment Through</td><td ><div  id="confirm_payment_info"></div ></td></tr>
        
       
  </table>
<h3>Terms and Conditions</h3>

<!-- Scrollable Terms -->
<div id="terms-box" style="height: 220px; overflow-y: scroll; border: 1px solid #999; padding: 12px; margin-bottom: 10px;">
    <ul>
       <li>You must have 18 years of age or older.</li>
        <li>You have understood these Terms with the company and you have clearly understood the terms and conditions of the Services.</li>
        <li>You shall provide us any proof of identity we may request, and as may be specified by the Reserve Bank of India (“RBI”) in relation to any Customer Due Diligence or Know-Your-Customer processes, as may be applicable and shall not refuse to cooperate in an investigation or provide confirmation of your identity or any other information you provide to the company.</li>
        <li>With all necessary documentation, only the loan will be provided.</li>
        <li>You have to obeyed the legally binding contracts under the Indian Contract Act, 1872.</li>
        <li>
            <strong>Condition Regarding Enforcement of Security Interest under Section 13(4) of the SARFAESI Act, 2002:</strong><br>
            The Borrower expressly acknowledges and agrees that, in the event of default in repayment of the secured debt or failure to comply with the terms of the loan agreement, the Secured Creditor shall be entitled to invoke its rights under Section 13(4) of the Securitisation and Reconstruction of Financial Assets and Enforcement of Security Interest Act, 2002 (SARFAESI Act). This includes, but is not limited to, the right to take possession of, manage, or sell the secured assets without the intervention of a court, in order to recover the outstanding dues.
        </li>
        <li>If interest remains unpaid for over two months, Section 13(4) of the SARFAESI Act, 2002 applies.</li>
        <li>We are not responsible for your assets' damages or if it was in non-working conditions at the time of return.</li>
        <li>These Terms, along with Company’s Privacy Policy, as amended and updated from time to time, constitute the entire agreement between the User(s) and company, superseding any prior written or oral contracts in relation to the same subject matter herein.</li>
    </ul>
</div>

<!-- Checkbox -->
<label class="custom-checkbox-label">
  <input type="checkbox" id="agree-checkbox" disabled />
  <span class="checkbox-text">
    I have read and agree to the Terms and Conditions
  </span>
</label>


<!-- Continue Button -->

      <div class="note1">⚠️ Please carefully review all the details above and ensure you’ve made any necessary edits. <br>
    Make sure you’ve read the Terms and Conditions. Tick the box Above to confirm before submitting.</div>
      
        
      <div class="btns">
        <button type="button" onclick="prevStep()">Back</button>
        <button  class="proceed-btn"  id="continue-btn" disabled> Finish &Submit</button>

      </div>
    </div>
  </div>

</form>
  <script src="{% static 'js/loan_form_1.js' %}"></script>
  <script src="{% static 'js/payment_details.js' %}"></script>

  <script>
    window.addEventListener("DOMContentLoaded", function () {
        const termsBox = document.getElementById("terms-box");
        const agreeCheckbox = document.getElementById("agree-checkbox");
        const continueBtn = document.getElementById("continue-btn");

        // Enable checkbox after scrolling to bottom
        termsBox.addEventListener("scroll", () => {
            const buffer = 5;  // allow slight difference
    const atBottom = termsBox.scrollTop + termsBox.clientHeight >= termsBox.scrollHeight - buffer;

           if (atBottom) {
                agreeCheckbox.disabled = false;
            }
        });

        // Enable continue button if checkbox is checked
        agreeCheckbox.addEventListener("change", () => {
            continueBtn.disabled = !agreeCheckbox.checked;
        });
    });
    function validatestep1() {
      const reason = document.getElementById("notes").value.trim();
      const name = document.getElementById('borrower_name').value;
      if (!name){
        alert('enter your name');
         document.getElementById('borrower_name').focus();
        return ;
      }
      const phone = document.getElementById("phone");
  const loanItem = document.getElementById("loan_item");
  const amount = document.getElementById("amount");
  const paymentPlan = document.getElementById("payment_plan");
  const takenDate = document.getElementById("taken_date");

  const phonePattern = /^\d{10}$/;
  if (!phonePattern.test(phone.value.trim())) {
    alert("Phone number must be exactly 10 digits.");
    phone.focus();
    return false;
  }

  if (!loanItem.value.trim()) {
    alert("Please enter or select a loan item.");
    loanItem.focus();
    return false;
  }

  if (!amount.value.trim() || parseFloat(amount.value) <= 0) {
    alert("Please enter a valid amount greater than 0.");
    amount.focus();
    return false;
  }

  if (!paymentPlan.value) {
    alert("Please select a payment plan.");
    paymentPlan.focus();
    return false;
  }

  if (!takenDate.value) {
    alert("Please select a loan taken date.");
    takenDate.focus();
    return false;
  }
      if (!reason) {
        alert("Please enter a reason for the loan.");
        document.getElementById("notes").focus();
        return ;
      }
      
      nextStep()
    }
    function validatestep2(){
      val = confirmSubmit();
      if(val){
        populateConfirmation();
        nextStep();
      }
      return false ;
    }

    function populateConfirmation() {
  document.getElementById("confirm_borrower_name").innerText = document.getElementById("borrower_name").value;
  document.getElementById("confirm_phone").innerText = document.getElementById("phone").value;
  document.getElementById("confirm_loan_item").innerText = document.getElementById("loan_item").value;
  document.getElementById("confirm_amount").innerText = document.getElementById("amount").value;
  document.getElementById("confirm_payment_plan").innerText = document.getElementById("payment_plan").value;
  document.getElementById("confirm_taken").innerText = document.getElementById("taken_date").value;
  document.getElementById("confirm_return").innerText = document.getElementById("return_date").value;
  document.getElementById("confirm_reason").innerText = document.getElementById("notes").value;
  
  document.getElementById("confirm_referral").innerText = document.getElementById("referral").value;

  const paymentType = document.getElementById("payment_type").value;
  document.getElementById("confirm_payment_type").innerText = paymentType;

  let paymentInfo = "";
  if (paymentType === "cash") {
    paymentInfo = "From: " + document.getElementById("cash_from").value;
  } else if (paymentType === "online") {
    const method = document.getElementById("online_method").value;
    if (["phonepay", "googlepay", "paytm"].includes(method)) {
      paymentInfo = `(${method}): ${document.getElementById("upi_number").value} -- ${document.getElementById("account_holder_name").value}`;
    }
  }
  document.getElementById("confirm_payment_info").innerText = paymentInfo;
}


    let currentStep = 1;
    const totalSteps = 3;

    function showStep(step) {
      for (let i = 1; i <= totalSteps; i++) {
        document.getElementById(`form-step-${i}`).classList.remove('active');
        document.getElementById(`step-${i}`).classList.remove('active', 'completed');
      }

      for (let i = 1; i < step; i++) {
        document.getElementById(`step-${i}`).classList.add('completed');
      }

      document.getElementById(`form-step-${step}`).classList.add('active');
      document.getElementById(`step-${step}`).classList.add('active');

      updateProgressBar(step);
    }

    function updateProgressBar(step) {
      const percentage = ((step - 1) / (totalSteps - 1)) * 100;
      document.getElementById("progress-bar-fill").style.width = percentage + "%";
    }

    function nextStep() {
      if (currentStep < totalSteps) {
        currentStep++;
        showStep(currentStep);
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
      }
    }

    // Initialize first step
    showStep(currentStep);
  </script>
</body>
</html>
